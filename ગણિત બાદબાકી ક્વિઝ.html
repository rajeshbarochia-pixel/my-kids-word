<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ગણિત ક્વિઝ ગેમ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Vibrant Gradient Background */
            background: linear-gradient(135deg, #fce9f1 0%, #e0f2fe 100%); 
        }
        /* Increased shadow on the main game card for depth */
        #gameContainer {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }

        .option-circle {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* Full rounded circle */
            font-size: 2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border: 4px solid transparent;
            user-select: none; /* Prevent selection on tap */
        }
        .option-circle:hover {
            transform: scale(1.05);
        }
        .option-circle:active {
            transform: scale(0.98);
        }
        .correct-answer {
            background-color: #4ade80; /* Bright Green 400 */
            border-color: #16a34a; /* Darker Green 600 */
            color: #166534; /* Green 800 */
            animation: pulse-correct 0.3s 3;
        }
        .incorrect-answer {
            background-color: #fca5a5; /* Red 400 */
            border-color: #dc2626; /* Red 600 */
            color: #991b1b; /* Red 900 */
            animation: shake 0.5s;
        }
        /* New Colorful Default Option */
        .default-option {
            background-color: #f3e8ff; /* Light Purple */
            border-color: #a855f7; /* Purple 500 */
            color: #4c1d95; /* Dark Purple */
        }

        @keyframes pulse-correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            20%, 60% {transform: translateX(-5px);}
            40%, 80% {transform: translateX(5px);}
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4">

    <!-- Header and Score - Background changed to white, standard shadow -->
    <div class="w-full max-w-md bg-white p-6 rounded-xl shadow-lg mt-4 mb-8">
        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-2">ગણિત ક્વિઝ</h1>
        <p class="text-lg text-center text-green-600 font-semibold"> બાદબાકીની પ્રેક્ટિસ કરો</p>
        
        <!-- Creator Name Added Here -->
        <p class="text-sm text-center text-gray-500 mt-1 mb-3">બનાવનાર: Rajesh Barochia</p>

        <div id="scoreDisplay" class="text-xl font-bold text-center mt-4 p-2 bg-indigo-100 rounded-lg text-indigo-700">
            સ્કોર: 0
        </div>
    </div>

    <!-- Question and Options Area -->
    <div id="gameContainer" class="w-full max-w-md bg-white p-6 rounded-xl shadow-2xl transition-all duration-300">
        
        <!-- Question Display - Changed to a vibrant yellow/amber color -->
        <div id="questionDisplay" class="text-5xl font-bold text-center text-gray-900 mb-8 p-4 bg-yellow-300 rounded-xl shadow-md border-b-4 border-amber-500">
            <!-- Question will be loaded here -->
            ક્વિઝ શરૂ કરવા માટે "નવી ગેમ" બટન દબાવો.
        </div>

        <!-- Options Grid -->
        <div id="optionsGrid" class="flex justify-around space-x-4 mb-8">
            <!-- Options will be loaded here -->
        </div>

        <!-- Feedback Message -->
        <div id="feedbackMessage" class="text-2xl font-semibold text-center h-8 mb-4">
            <!-- Feedback will appear here -->
        </div>

        <!-- Control Button - Changed to Indigo for prominence -->
        <button id="controlButton" onclick="startGame()" class="w-full p-4 text-xl font-bold text-white bg-indigo-600 rounded-xl shadow-lg hover:bg-indigo-500 transition duration-150">
            ગેમ શરૂ કરો
        </button>
        
        <!-- Progress Indicator -->
        <div id="progressDisplay" class="text-center text-sm font-medium text-gray-600 mt-3">
            <!-- Progress will be loaded here -->
        </div>

    </div>

    <script>
        // Global variables
        let score = 0;
        let currentQuestionNumber = 0; // Question number currently displayed/answered
        const maxQuestions = 5; // Maximum questions per game
        let correctAnswer = 0;
        let isQuestionActive = false;
        
        const scoreDisplay = document.getElementById('scoreDisplay');
        const questionDisplay = document.getElementById('questionDisplay');
        const optionsGrid = document.getElementById('optionsGrid');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const controlButton = document.getElementById('controlButton');
        const progressDisplay = document.getElementById('progressDisplay');

        /**
         * Converts standard numbers to Gujarati numbers (optional, but good for immersion)
         */
        const toGujaratiDigits = (num) => {
             // Use standard digits 
             return String(num); 
        };

        /**
         * Generates a random subtraction question and its correct answer.
         * Ensures N1 >= N2.
         */
        function generateQuestion() {
            // Numbers between 5 and 15 for N1, and 1 and 10 for N2
            const N1 = Math.floor(Math.random() * 11) + 5; // 5 to 15
            let N2 = Math.floor(Math.random() * Math.min(N1, 10)) + 1; // 1 to min(N1, 10)
            
            // Avoid N1-N2 = 0 frequently, but allow it.
            if (N1 === N2 && Math.random() < 0.5) {
                // Reroll N2 if they are equal and random check passes, to reduce zero answers
                const newN2 = Math.floor(Math.random() * (N1 - 1)) + 1;
                if (newN2 > 0) N2 = newN2;
            }

            correctAnswer = N1 - N2;
            questionDisplay.innerHTML = `${toGujaratiDigits(N1)} - ${toGujaratiDigits(N2)} =`;
            
            return correctAnswer;
        }

        /**
         * Generates an array of 4 unique options including the correct answer.
         */
        function generateOptions(correct) {
            let options = new Set();
            options.add(correct);

            // Function to get a unique random incorrect answer
            while (options.size < 4) {
                let incorrect = correct + Math.floor(Math.random() * 5) - 2; // Range: correct - 2 to correct + 2
                
                // Ensure options are non-negative and not the correct answer
                if (incorrect < 0) {
                    incorrect = correct + 1;
                }
                if (incorrect === correct) {
                    incorrect = correct + (Math.random() < 0.5 ? 1 : -1);
                }

                // Ensure non-negative again
                if (incorrect >= 0) {
                    options.add(incorrect);
                }
            }
            
            // Convert Set to Array and shuffle
            let optionsArray = Array.from(options);
            optionsArray.sort(() => Math.random() - 0.5);

            return optionsArray;
        }

        /**
         * Renders the question and options on the screen, or ends the game.
         */
        function loadNewQuestion() {
            if (currentQuestionNumber >= maxQuestions) {
                endGame();
                return;
            }

            // Increment question counter before loading
            currentQuestionNumber++;

            // 1. Generate Question
            const correct = generateQuestion();

            // 2. Generate Options
            const options = generateOptions(correct);

            // 3. Render Options
            optionsGrid.innerHTML = '';
            options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-circle default-option';
                optionDiv.innerText = toGujaratiDigits(option);
                optionDiv.setAttribute('data-value', option);
                optionDiv.onclick = () => checkAnswer(optionDiv, option);
                optionsGrid.appendChild(optionDiv);
            });

            // Reset feedback and button for active question
            feedbackMessage.innerHTML = '';
            controlButton.disabled = true;
            controlButton.classList.add('opacity-50', 'cursor-not-allowed');
            controlButton.innerText = 'જવાબ આપો';
            isQuestionActive = true;
            
            // Remove the temporary text-2xl class from questionDisplay if it was present
            questionDisplay.classList.remove('text-2xl', 'font-semibold', 'text-amber-800');
            questionDisplay.classList.add('text-5xl', 'font-bold', 'text-gray-900');

            // Update progress
            progressDisplay.innerText = `પ્રશ્ન ${currentQuestionNumber} માંથી ${maxQuestions}`;
        }

        /**
         * Checks the user's selected answer.
         */
        function checkAnswer(selectedDiv, selectedValue) {
            if (!isQuestionActive) return;

            // Disable all options after selection
            const allOptions = optionsGrid.querySelectorAll('.option-circle');
            allOptions.forEach(div => {
                div.onclick = null;
                div.classList.remove('default-option');
            });

            isQuestionActive = false; // Pause interaction

            // Determine next button text
            const nextButtonText = (currentQuestionNumber < maxQuestions) ? 'આગળનો પ્રશ્ન' : 'રિઝલ્ટ જુઓ';
            
            controlButton.disabled = false;
            controlButton.classList.remove('opacity-50', 'cursor-not-allowed');
            controlButton.innerText = nextButtonText;

            if (selectedValue === correctAnswer) {
                // Correct Answer Logic
                score++;
                selectedDiv.classList.add('correct-answer');
                feedbackMessage.innerHTML = '<span class="text-green-700">સાચું!</span>';
                
            } else {
                // Incorrect Answer Logic
                selectedDiv.classList.add('incorrect-answer');
                feedbackMessage.innerHTML = `<span class="text-red-700">ખોટું! જવાબ હતો: ${toGujaratiDigits(correctAnswer)}</span>`;

                // Highlight the correct answer
                allOptions.forEach(div => {
                    if (parseInt(div.getAttribute('data-value')) === correctAnswer) {
                        div.classList.add('correct-answer');
                    }
                });
            }

            scoreDisplay.innerHTML = `સ્કોર: ${score}`;
        }

        /**
         * Ends the game and shows the final score.
         */
        function endGame() {
            isQuestionActive = false;
            questionDisplay.innerHTML = `<span class="text-4xl">ક્વિઝ સમાપ્ત!</span>`;
            feedbackMessage.innerHTML = `<span class="text-xl font-bold text-indigo-700">તમારો ફાઇનલ સ્કોર: ${toGujaratiDigits(score)} માંથી ${toGujaratiDigits(maxQuestions)}</span>`;
            
            // Clear options grid
            optionsGrid.innerHTML = `
                <p class="text-center text-gray-500 w-full">બધા પ્રશ્નો પૂરા થયા.</p>
            `;

            // Reset button to start new game
            controlButton.innerText = 'ફરીથી રમો';
            controlButton.classList.remove('opacity-50', 'cursor-not-allowed');
            controlButton.disabled = false;

            progressDisplay.innerText = ''; // Clear progress indicator
            
            // Restore initial large question display class for the final message
            questionDisplay.classList.remove('text-2xl', 'font-semibold', 'text-amber-800');
            questionDisplay.classList.add('text-5xl', 'font-bold', 'text-gray-900');
        }

        /**
         * Starts a new game or moves to the next question.
         */
        function startGame() {
            if (controlButton.innerText === 'ગેમ શરૂ કરો' || controlButton.innerText === 'ફરીથી રમો') {
                // New Game Initialization
                score = 0;
                currentQuestionNumber = 0;
                scoreDisplay.innerHTML = 'સ્કોર: 0';
            }
            
            loadNewQuestion();
        }

        // Initialize the app on load
        window.onload = function() {
            // Set initial button state
            controlButton.innerText = 'ગેમ શરૂ કરો';
            
            // Initial placeholder options setup
            optionsGrid.innerHTML = `
                <div class="option-circle default-option opacity-50">?</div>
                <div class="option-circle default-option opacity-50">?</div>
                <div class="option-circle default-option opacity-50">?</div>
                <div class="option-circle default-option opacity-50">?</div>
            `;
            
            // Set smaller, beautiful starting text
            // Note: We temporally remove the large text classes on onload for the introductory message
            questionDisplay.classList.remove('text-5xl', 'font-bold', 'text-gray-900');
            questionDisplay.classList.add('text-2xl', 'font-semibold', 'text-amber-800');

            questionDisplay.innerHTML = 'તૈયાર છો? ક્વિઝ શરૂ કરવા માટે "ગેમ શરૂ કરો" બટન દબાવો.';
            progressDisplay.innerText = `કુલ પ્રશ્નો: ${maxQuestions}`;
        };
    </script>

</body>
</html>
