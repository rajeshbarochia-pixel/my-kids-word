<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>àª«àª³ àª—àª£àª¿àª¤ | Fruit Math</title>
    <style>
        /* Custom Font and Global Styling */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Gujarati:wght@400;700;900&display=swap');
        
        :root {
            --primary-yellow: #FFD700;
            --secondary-orange: #FF8C00;
            --light-cream: #FFFDD0;
            --paper-white: #FFFFFF;
            --dot-color: #F0E68C;
            --text-color: #333333;
            --paper-border: #FFC0CB; /* Pinkish red border */
        }

        body {
            font-family: 'Noto Sans Gujarati', sans-serif;
            background-color: var(--primary-yellow);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Dotted pattern background matching the image */
            background-image: radial-gradient(var(--dot-color) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .container {
            width: 95%;
            max-width: 500px;
            margin: 20px auto;
            padding: 10px;
            text-align: center;
        }

        /* Header and Title */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
        }

        .score-box, .refresh-btn {
            background-color: var(--light-cream);
            border: 2px solid var(--secondary-orange);
            border-radius: 12px;
            padding: 8px 15px;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .refresh-btn {
            font-size: 1.5rem;
            cursor: pointer;
            border: none;
            background-color: #FF6347;
            color: white;
            padding: 5px 10px;
            line-height: 1;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--secondary-orange);
            margin: 0;
        }

        .instructions {
            background-color: var(--light-cream);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.4;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
            border: 1px solid #FFCD94;
        }

        /* Value Display (Key Area) */
        .value-key {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .value-item {
            display: flex;
            align-items: center;
            background-color: var(--paper-white);
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .fruit-icon {
            font-size: 1.8rem;
            margin-right: 8px;
        }

        /* Problem Area (Paper-like look) */
        .problem-area {
            background-color: var(--paper-white);
            border: 1px dashed var(--dot-color);
            border-radius: 15px;
            padding: 20px 10px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            margin-bottom: 30px;
        }

        .problem-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 15px;
            height: 100%;
            width: 2px;
            background-color: var(--paper-border);
        }

        .equation-line {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 5px 0;
            position: relative;
        }

        .operator-sign {
            position: absolute;
            left: 10%;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .result-box {
            height: 60px;
            margin-top: 15px;
            border-top: 3px double var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: #ccc;
        }
        
        .result-box.correct {
            color: green;
        }

        /* Answer Options */
        .answer-label {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 20px 0 10px;
            color: var(--secondary-orange);
            text-shadow: 1px 1px 1px #fff;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-btn {
            background-color: var(--light-cream);
            color: var(--text-color);
            border: none;
            border-radius: 15px;
            padding: 20px 10px;
            font-size: 2.5rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 5px 0 #EAB543;
            transition: all 0.1s;
        }

        .option-btn:hover {
            background-color: #FFEEAA;
        }

        .option-btn:active {
            box-shadow: 0 2px 0 #EAB543;
            transform: translateY(3px);
        }

        .correct-answer {
            background-color: #A9D18E !important; /* Green */
            box-shadow: 0 5px 0 #688F4F !important;
        }
        
        .incorrect-answer {
            background-color: #F4C7C3 !important; /* Red */
            box-shadow: 0 5px 0 #BC5449 !important;
        }

        /* Footer */
        .footer {
            margin-top: auto;
            padding: 10px;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="score-box">
                â­ <span id="score">à«¦</span>
            </div>
            <h1>àª«àª³ àª—àª£àª¿àª¤</h1>
            <button class="refresh-btn" onclick="initializeGame()">â†º</button>
        </div>

        <p class="instructions">àª«àª³à«‹àª¨à«€ àª•àª¿àª‚àª®àª¤ àªœà«àª“, àª—àª£àª¤àª°à«€ àª•àª°à«‹ àª…àª¨à«‡ àª¸àª¾àªšà«‹ àªœàªµàª¾àª¬ àª¬à«‹àª•à«àª¸àª®àª¾àª‚ àª®à«‚àª•à«‹!</p>

        <div class="value-key" id="value-key">
            <!-- Fruit values will be injected here -->
        </div>

        <div class="problem-area">
            <div id="equation-display">
                <!-- Equation lines will be injected here -->
            </div>
            <div class="result-box" id="result-box">?</div>
        </div>
        
        <div id="message-box" style="font-size: 1.2rem; margin-bottom: 10px; min-height: 24px;"></div>

        <div class="answer-label">àªœàªµàª¾àª¬ àªªàª¸àª‚àª¦ àª•àª°à«‹:</div>
        <div class="options-grid" id="options-grid">
            <!-- Answer buttons will be injected here -->
        </div>
    </div>

    <footer class="footer">
        Created by: Rajesh barochia
    </footer>

    <script>
        // Global State
        let score = 0;
        let currentProblem = {};
        const MAX_VALUE = 10; // Maximum value for a single fruit
        const MIN_VALUE = 2;  // Minimum value for a single fruit
        const MAX_TERMS = 4; // Maximum number of terms in the equation
        const MIN_TERMS = 2; // Minimum number of terms in the equation

        const FRUITS = {
            'ğŸ': 'àª¸àª«àª°àªœàª¨',
            'ğŸŒ': 'àª•à«‡àª³à«àª‚',
            'ğŸ¥­': 'àª•à«‡àª°à«€'
        };

        const NUM_FRUITS = Object.keys(FRUITS);
        const GUJARATI_DIGITS = ['à«¦', 'à«§', 'à«¨', 'à«©', 'à«ª', 'à««', 'à«¬', 'à«­', 'à«®', 'à«¯'];

        /**
         * Converts a standard number to its Gujarati string representation.
         * @param {number} num The number to convert.
         * @returns {string} The Gujarati number string.
         */
        function toGujarati(num) {
            return String(num).split('').map(digit => {
                const parsed = parseInt(digit);
                return isNaN(parsed) ? digit : GUJARATI_DIGITS[parsed];
            }).join('');
        }

        /**
         * Shuffles an array in place using the Fisher-Yates algorithm.
         * @param {Array} array The array to shuffle.
         * @returns {Array} The shuffled array.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Generates a new random math puzzle with addition and subtraction.
         * @returns {Object} The puzzle data including values, equation, and correct answer.
         */
        function generatePuzzle() {
            const fruitKeys = shuffleArray([...NUM_FRUITS]);
            
            // Define fruit values (2 or 3 fruits for the key)
            const numKeyFruits = Math.floor(Math.random() * (NUM_FRUITS.length - 1)) + 2; // 2 or 3 fruits
            const keyFruits = fruitKeys.slice(0, numKeyFruits);

            const fruitValues = {};
            keyFruits.forEach(fruit => {
                // Assign a random value between MIN_VALUE and MAX_VALUE
                fruitValues[fruit] = Math.floor(Math.random() * (MAX_VALUE - MIN_VALUE + 1)) + MIN_VALUE; 
            });

            // Randomly select the items for the equation (2 to MAX_TERMS terms)
            const numTerms = Math.floor(Math.random() * (MAX_TERMS - MIN_TERMS + 1)) + MIN_TERMS;
            const equation = [];
            let result = 0;
            
            // 1. Set the first term (always added)
            const firstFruit = keyFruits[Math.floor(Math.random() * keyFruits.length)];
            equation.push({ fruit: firstFruit, operator: '+' });
            result = fruitValues[firstFruit];

            // 2. Add remaining terms with random operators
            for (let i = 1; i < numTerms; i++) {
                const randomFruit = keyFruits[Math.floor(Math.random() * keyFruits.length)];
                
                // Choose operator: + or -
                let operator = Math.random() < 0.5 ? '+' : '-';
                let value = fruitValues[randomFruit];

                // Ensure the result remains positive (for simpler math for kids)
                if (operator === '-' && (result - value <= 0)) {
                    // If subtraction would result in zero or negative, change to addition
                    operator = '+';
                }
                
                equation.push({ fruit: randomFruit, operator: operator });
                result = operator === '+' ? result + value : result - value;
            }

            const correctAnswer = result;

            // Generate answer options
            const options = new Set([correctAnswer]);
            while (options.size < 4) {
                // Generate wrong answers near the correct answer
                let offset = Math.floor(Math.random() * 8) - 4; // offset from -4 to +3
                if (offset >= 0 && offset < 1) offset = 1; // skip 0 and keep wrong answers away from the correct answer
                if (offset < 0 && offset > -1) offset = -1; // skip 0

                let wrongAnswer = correctAnswer + offset;
                
                // Ensure wrong answer is positive and not equal to the correct answer
                if (wrongAnswer > 0 && wrongAnswer !== correctAnswer) {
                    options.add(wrongAnswer);
                }
            }

            const answerOptions = shuffleArray(Array.from(options));

            return {
                values: fruitValues,
                equation: equation,
                correctAnswer: correctAnswer,
                options: answerOptions
            };
        }

        /**
         * Renders the current puzzle to the DOM.
         */
        function renderGame() {
            // 1. Generate new puzzle
            currentProblem = generatePuzzle();
            const { values, equation, options } = currentProblem;

            // Clear previous state
            document.getElementById('result-box').innerHTML = '?';
            document.getElementById('result-box').classList.remove('correct', 'incorrect');
            document.getElementById('message-box').textContent = '';

            // 2. Render Value Key
            const valueKeyEl = document.getElementById('value-key');
            valueKeyEl.innerHTML = Object.entries(values).map(([fruit, value]) => `
                <div class="value-item">
                    <span class="fruit-icon">${fruit}</span> = <span class="gujarati-num">${toGujarati(value)}</span>
                </div>
            `).join('');

            // 3. Render Equation
            const equationDisplayEl = document.getElementById('equation-display');
            equationDisplayEl.innerHTML = equation.map((item, index) => {
                // Use the operator only for terms after the first one
                const operatorSign = index > 0 ? `<span class="operator-sign">${item.operator}</span>` : '';
                return `
                    <div class="equation-line">
                        ${operatorSign}
                        <span class="fruit-icon" style="font-size: 4rem;">${item.fruit}</span>
                    </div>
                `;
            }).join('');

            // 4. Render Answer Options
            const optionsGridEl = document.getElementById('options-grid');
            optionsGridEl.innerHTML = options.map(option => `
                <button class="option-btn" data-value="${option}" onclick="checkAnswer(this, ${option})">
                    ${toGujarati(option)}
                </button>
            `).join('');

            // Update score display
            document.getElementById('score').textContent = toGujarati(score);
        }

        /**
         * Checks the user's selected answer.
         * @param {HTMLElement} button The button element clicked by the user.
         * @param {number} selectedValue The numerical value of the selected answer.
         */
        function checkAnswer(button, selectedValue) {
            const isCorrect = selectedValue === currentProblem.correctAnswer;
            const resultBoxEl = document.getElementById('result-box');
            const messageBoxEl = document.getElementById('message-box');
            
            // Disable all buttons after selection
            document.querySelectorAll('.option-btn').forEach(btn => btn.onclick = null);

            // Show result
            resultBoxEl.innerHTML = toGujarati(currentProblem.correctAnswer);
            button.classList.add(isCorrect ? 'correct-answer' : 'incorrect-answer');
            
            if (isCorrect) {
                score++;
                messageBoxEl.textContent = 'àª¸àª¾àªšà«‹ àªœàªµàª¾àª¬! ğŸ¥³';
                messageBoxEl.style.color = 'green';
            } else {
                messageBoxEl.textContent = 'àª–à«‹àªŸà«‹ àªœàªµàª¾àª¬! àª¸àª¾àªšà«‹ àªœàªµàª¾àª¬ àªœà«àª“. ğŸ¤”';
                messageBoxEl.style.color = '#FF6347';
            }
            
            resultBoxEl.classList.add(isCorrect ? 'correct' : 'incorrect');

            // Find the correct button and highlight it if the user was wrong
            if (!isCorrect) {
                 document.querySelectorAll('.option-btn').forEach(btn => {
                    if (parseInt(btn.getAttribute('data-value')) === currentProblem.correctAnswer) {
                        btn.classList.add('correct-answer');
                    }
                });
            }

            // Load new puzzle after a delay
            setTimeout(renderGame, 2000);
        }

        /**
         * Initializes or resets the entire game.
         */
        function initializeGame() {
            score = 0;
            renderGame();
        }

        // Start the game when the window loads
        window.onload = initializeGame;
    </script>
</body>
</html>